<script type="text/x-red" data-template-name="EnOcean-com">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row node-config-input-serial">
        <label for="node-config-input-serial"><i class="fa fa-random"></i> <span data-i18n="serial.label.serialport"></span></label>
        <input type="text" id="node-config-input-serial">
    </div>
</script>

<script type="text/x-red" data-help-name="EnOcean-com" charset="utf-8">
    <p>シリアルポートからEnOceanデータを読み込み各センサーのデータを内部に保存します</p>
    <p>このノードを使うにはUSBポートにEnOceanドングルを差し込む必要があります。</p>
    <p>このノードは各種のEnOcean通信をサポートしたセンサデバイスからEnOcean通信を受信し各センサIDごとのESP電文を設定ノードであるenOceanLinkObjに格納します</p>
    <p>受信するデータは下記のいずれかを指定可能 <ul>
    <li>区切り文字を待つ(デフォルトは \n)。区切り文字は16進表記(0x0d)の指定も可。</li>
    <li>最初の文字を受信してからミリ秒単位のタイムアウトを待つ。</li>
    <li>一定サイズのバッファを満たすまで待つ。</li></ul></p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('EnOcean-com',{
        category: 'config',
        defaults: {
            name: {name:""},
            serial: {type:"serial-port",required:true}
        },
        label: function() {
            var serialNode = RED.nodes.node(this.serial);
            return this.name||(serialNode?serialNode.label().split(":")[0]:this._("serial.label.serial"));
        }
    });
</script>

<!-- EnOcean-object Node の記述 -->
<script type="text/x-red" data-template-name="EnOcean-obj">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>

    <div class="form-row">
      <input type="text" style="display: none;" id="node-input-confsel" value="propertySet">
      <input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
            name="configSel" id="node-input-configSel1"
            value="propertySet" checked="checked">
      <label style="width: 40%;" for="node-input-configSel1"> オブジェクト設定</label>
      <input type="radio" style="display: inline-block; width: auto; vertical-align: top;"
            name="configSel" id="node-input-configSel2" value="fileSet">
      <label style="width: 40%;" for="node-input-configSel2"> 設定ファイル</label>
    </div>
<br>
    <div class="row" style="margin-left: 20px;" id="node-row-fileSet">
        <label>i_設定ファイル名を入力してください<span style="color: #ff0000;">*</span></label>
        <input id="node-input-configfile" type="text" style="width: 400px;" placeholder="フルパスのファイル名">
    </div>

    <!-- object propertyの設定 -->
    <div class="form-group" id="node-row-propertySet" style="margin-left: 20px;">
        <div class="form-row">
            <label for="node-input-object_key"><i class="fa fa-flag"></i> <span data-i18n="enoceanDataItem.label.object_key"></span></label>
            <input type="text" id="node-input-object_key" data-i18n="enoceanDataItem.label.object_key">
        </div>
        <div class="form-row">
            <label for="node-input-object_desc"><i class="fa fa-tag"></i> <span data-i18n="enoceanDataItem.label.object_desc"></span></label>
            <input type="text" id="node-input-object_desc" data-i18n="enoceanDataItem.label.object_desc">
        </div>
        <div class="form-row">
            <label for="node-input-enoceandataitem"><i class="fa fa-random"></i> <span data-i18n="serial.label.enoceanDataItems"></span></label>
            <input type="text" id="node-input-enoceandataitem">
        </div>
    </div>
<hr>
    <!-- EnOcean-com node の選択-->
    <div class="form-row">
        <label for="node-input-enoceancom"><i class="fa fa-random"></i> <span data-i18n="serial.label.enoceanCom"></span></label>
        <input type="text" id="node-input-enoceancom">
    </div>
    <div class="form-row hide">
        <input type="text" style="width: 300px" id="node-input-objectConfig">
    </div>

</script>

<script type="text/x-red" data-help-name="EnOcean-obj" charset="utf-8">
    <p>一定周期あるいは非同期にia-cloudオブジェクトを生成して出力します</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('EnOcean-obj',{
        category: 'iaCloud',
        defaults: {
            name: {name:""},
            confsel: {value:"propertySet"},
            configfile: {value:"", required: false},
            object_key: {value:""},
            object_desc: {value:""},
            enoceancom: {type:"EnOcean-com", required:true, value:""},
            enoceandataitem: {type:"EnOcean-dItems", required:true, value:""}
        },
        color:"#C7E9C0",
        inputs:1,
        outputs:1,
        icon: "swap.png",
        label: function() {
            return this.name || "EnOcean Object";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
          $('input[name="configSel"]:radio').change(function() {
            if ($("#node-input-configSel1").is(":checked")) {
                $("#node-row-propertySet").show();
                $("#node-row-fileSet").hide();
                $('#node-input-confsel').val("propertySet");
            } else {
                $("#node-row-fileSet").show();
                $("#node-row-propertySet").hide();
                $('#node-input-confsel').val("fileSet");
            }
          });
          if($("#node-input-confsel").val() == "propertySet"){
              $('#node-input-configSel1').prop('checked', true);
          } else {
              $('#node-input-configSel2').prop('checked', true);
          }
          $('input[name="configSel"]:radio').change();
        },

        oneditsave: function() {
          var objectConfig = "ready";
          if ($("#node-input-confsel").val() == "propertySet") {
             if (!$("#node-input-objectKey").val()) objectConfig = "";
          }
          if (($("node-input-confsel").val() == "fileSet") && !$("#node-input-configfile").val()) objectConfig = "";
          $("#node-input-objectConfig").val(objectConfig);
        }
    });
</script>

<!-- EnOcean-dItems Config Node の記述 -->
<script type="text/x-red" data-template-name="EnOcean-dItems">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-config-input-sensor_kind"><i class="fa fa-thermometer-half"></i> <span data-i18n="serial.label.sensor_kind"></span></label>
        <select type="text" id="node-config-input-sensor_kind">
            <option value="u-rd">電流センサー(U-RD)</option>
            <option value="watty">温度センサー(Watty)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-sensor_id"><i class="fa fa-flag"></i> <span data-i18n="serial.label.sensor_id"></span></label>
        <input type="text" id="node-config-input-sensor_id" data-i18n="serial.label.sensor_id">
    </div>
    <div class="form-row hidden">
        <input type="text" id="node-config-input-configObject">
    </div>
    <div id="blocks">
        <div class="form-block" id="form_block[0]">
            <div class="form-row">
                <div class="form-inline" id="from_del[0]" >
                    <span style="border-bottom:solid 2px;">データ項目 :</span>
                    <input type="text" id="dItem[0]" style="width: 30px;" value="1" disabled="disabled">
                    <input type="button" name="del_btn" value="削除"
                        style="margin-left: 30px; width: 70px; display: none;">
                </div>
            </div>
            <table>
              <tr>
                <td>
                  <label><i class="fa fa-tag"></i> <span data-i18n="enoceanDataItem.label.dataname"></span></label>
                </td>
                <td>
                  <input type="text" id="dataname[0]">
                </td>
              </tr>
              <tr>
                <td>
                  <label><i class="fa fa-tag"></i> <span data-i18n="enoceanDataItem.label.unit"></span></label>
                </td>
                <td>
                  <select id="unitType[0]" style="width: 100px;">
                      <option selected="selected" value="℃">℃</option>
                      <option value="A">A</option>
                  </select>
                </td>
              </tr>
            </table>
        </div>
    </div>
    <div class="form-block">
      <input type="button" id="form_add" name="add_btn" value="追加">
    </div>
</script>

<script type="text/x-red" data-help-name="EnOcean-dItems" charset="utf-8">
    <p>ia-cloudオブジェクトの情報を設定するノードです。ここでクラウドに通知する必要な情報を設定します。</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('EnOcean-dItems',{
        category: 'config',
        defaults: {
            name: {name:""},
            sensor_kind: {value:"u-rd", required:true},
            sensor_id: {value:"", required:true},
            configObject: {value:""}
        },
        label: function() {
            return this.name||("EnOcean Data Item");
        },
      oneditprepare: function() {
        var frm_cnt = 0;
        //あれば設定データを取り出して、formに展開する。
        var conf = $("#node-config-input-configObject").val();
        if (conf) {
          var dItems = {};
          try { dItems = JSON.parse(conf); }
          catch(e) { conf = "";}
        }
        if(conf != ""){
          //設定データがあった
          var dItems = JSON.parse(conf);
          //フォームを一つ保存
          var original = $('#form_block\\[0\\]');

          //一旦フォームオブジェクトをすべて削除
          $(".form-block[id^='form_block']")
              .each(function(index, formObj) {$(formObj).remove();});

          dItems.forEach(function(value, idx){
            original
            .clone()
            .hide()
            .appendTo("#blocks")
            .attr('id', 'form_block[' + idx + ']') // クローンのid属性を変更。
            .end() // 一度適用する
            .find('div, input, textarea, select, label').each(function(index, obj) {
              if ($(obj).attr('id') != null) {
                if($(obj).attr("id").substr(0,5) == "dItem"){
                    $(obj).val("" + (idx + 1));
                }
                $(obj).attr({
                  id: $(obj).attr('id').replace(/\[[0-9]+\]$/, '[' + idx + ']')
                });
              }
              if ($(obj).attr('name') != null) {
                $(obj).attr({
                    name: $(obj).attr('name').replace(/\[[0-9]+\]$/, '[' + idx + ']')
                 });
              }
              if ($(obj).attr('for') != null) {
                $(obj).attr({
                    for: $(obj).attr('for').replace(/\[[0-9]+\]$/, '[' + idx + ']')
                });
              }
          });
          $("#dataname\\[" + idx + "\\]").val(value.dataname);
          $("#unitType\\[" + idx + "\\]").val(value.unitType);
          
          var block = $('#form_block\\[' + idx + '\\]');
          if (idx != 0) block.find('input[name="del_btn"]').show();
          block.slideDown('slow');
          frm_cnt = idx;
          });
        }
        
        $("#node-config-input-sensor_kind").change(function (){
          //フォームを一つ保存
          var original = $('#form_block\\[0\\]');
          
          var num = 1;
          var str = $("select option:selected").val();
          if ( str == "u-rd" ) {
              num = 1;
          } else {
              num = 4;
          }
          
          //TODO: selectタグでセンサー種別を変更した場合に表示する内容を変更する
          /*******************************************************
          $(".form-block[id^='form_block']")
               .each(function(index, formObj) {$(formObj).remove();});
          for ( var idx = 0; idx < num; idx++ ) {
            original
              .clone()
              .hide()
              .appendTo("#blocks")
              .attr('id', 'form_block[' + idx + ']') // クローンのid属性を変更。
              .end() // 一度適用する
              .find('div, input, textarea, select, label').each(function(index, obj) {
                if ($(obj).attr('id') != null) {
                  if($(obj).attr("id").substr(0,5) == "dItem"){
                      $(obj).val("" + (idx + 1));
                  }
                  $(obj).attr({
                    id: $(obj).attr('id').replace(/\[[0-9]+\]$/, '[' + idx + ']')
                  });
                }
                if ($(obj).attr('name') != null) {
                  $(obj).attr({
                      name: $(obj).attr('name').replace(/\[[0-9]+\]$/, '[' + idx + ']')
                   });
                }
                if ($(obj).attr('for') != null) {
                  $(obj).attr({
                      for: $(obj).attr('for').replace(/\[[0-9]+\]$/, '[' + idx + ']')
                  });
                }
              });
            $("#dataname\\[" + idx + "\\]").val();
            $("#unitType\\[" + idx + "\\]").val();
          
            var block = $('#form_block\\[' + idx + '\\]');
            if (idx != 0) block.find('input[name="del_btn"]').show();
            block.slideDown('slow');
            frm_cnt = idx;
          }
          ****************************************************************/
        });
        
        //追加ボタンが押されたら
        $("#form_add").off("click");
        $("#form_add").on("click", function() {

          var original = $('#form_block\\[' + frm_cnt + '\\]');
          frm_cnt++;
          original
          .clone()
          .hide()
          .insertAfter(original)
          .attr('id', 'form_block[' + frm_cnt + ']'); // クローンのid属性を変更。
          var clone = $('#form_block\\[' + frm_cnt + '\\]');
          clone.find('div, input, textarea, select, label').each(function(idx, obj) {
            if ($(obj).attr('id') != null) {
              if($(obj).attr("id").substr(0,5) == "dItem"){
                  $(obj).val("" + (frm_cnt + 1));
              }
              $(obj).attr({
                id: $(obj).attr('id').replace(/\[[0-9]+\]$/, '[' + frm_cnt + ']')
              });
            }
            if ($(obj).attr('name') != null) {
              $(obj).attr({
                name: $(obj).attr('name').replace(/\[[0-9]+\]$/, '[' + frm_cnt + ']')
               });
            }
            if ($(obj).attr('for') != null) {
              $(obj).attr({
                for: $(obj).attr('for').replace(/\[[0-9]+\]$/, '[' + frm_cnt + ']')
              });
            }
          });
          clone.find('input[name="del_btn"]').show();
          clone.slideDown('fast');
        });
        
        //削除ボタンが押されたら
        $("#blocks").off('click', 'input[name="del_btn"]');
        $("#blocks").on('click', 'input[name="del_btn"]', function() {
          var removeObj = $(this).parents(".form-block");
          removeObj.fadeOut('fast', function() {
            removeObj.remove();
            // 番号振り直し
            frm_cnt = 0;
            $(".form-block[id^='form_block']").each(function(index, formObj) {
              if ($(formObj).attr('id') != 'form_block[0]') {
                frm_cnt++;
                $(formObj)
                  .attr('id', 'form_block[' + frm_cnt + ']') // id属性を変更。
                  .find('div, input, textarea, select, label').each(function(idx, obj) {
                   if ($(obj).attr('id') != null) {
                      if($(obj).attr("id").substr(0,5) == "dItem"){
                            $(obj).val("" + (frm_cnt + 1));
                      }
                      $(obj).attr({
                        id: $(obj).attr('id').replace(/\[[0-9]+\]$/,'['+frm_cnt+']')
                      });
                    }
                    if ($(obj).attr('name') != null) {
                      $(obj).attr({
                        name: $(obj).attr('name').replace(/\[[0-9]+\]$/,'['+frm_cnt+']')
                      });
                    }
                    if ($(obj).attr('for') != null) {
                      $(obj).attr({
                        for: $(obj).attr('for').replace(/\[[0-9]+\]$/,'['+frm_cnt+']')
                      });
                    }
                  });
              }
            });
          });
        });
      },

      oneditsave: function() {

        var dItems = [];
          $(".form-block[id^='form_block']").each(function(idx, obj){
              var item ={dataValue: "", unitType: "", dataname: ""};
              
              item.unitType = $("#unitType\\[" + idx + "\\]").val();
              item.dataname = $("#dataname\\[" + idx + "\\]").val();
              dItems[idx]=item;
          });
          //フォームの各要素をobjectに記述し、JSON文字列に変換する。
          try {$("#node-config-input-configObject").val(JSON.stringify(dItems));}
          catch(e) {$("#node-config-input-configObject").val("")}

      }
    });
</script>

<!-- serial-port Config Node の記述 -->
<script type="text/x-red" data-template-name="serial-port">
    <div class="form-row">
        <label for="node-config-input-serialport"><i class="fa fa-random"></i> <span data-i18n="serial.label.serialport"></span></label>
        <input type="text" id="node-config-input-serialport" style="width:66%;" data-i18n="[placeholder]serial.placeholder.serialport">
        <a id="node-config-lookup-serial" class="btn"><i id="node-config-lookup-serial-icon" class="fa fa-search"></i></a>
    </div>
    <div class="form-row">
        <table width="100%"><tr>
            <td width="100px"><i class="fa fa-wrench"></i> <span data-i18n="serial.label.settings"></span></td>
            <td width="110px" data-i18n="serial.label.baudrate"></td>
            <td width="70px" data-i18n="serial.label.databits"></td>
            <td width="80px" data-i18n="serial.label.parity"></td>
            <td width="70px" data-i18n="serial.label.stopbits"></td>
        </tr><tr><td>&nbsp;</td>
        <td>
            <input type="text" id="node-config-input-serialbaud" style="width:92%">
        </td><td>
        <select type="text" id="node-config-input-databits" style="width:90%;">
            <option value="8">8</option>
            <option value="7">7</option>
            <option value="6">6</option>
            <option value="5">5</option>
        </select>
        </td><td>
        <select type="text" id="node-config-input-parity" style="width:90%;">
            <option value="none" data-i18n="serial.parity.none"></option>
            <option value="even" data-i18n="serial.parity.even"></option>
            <option value="mark" data-i18n="serial.parity.mark"></option>
            <option value="odd" data-i18n="serial.parity.odd"></option>
            <option value="space" data-i18n="serial.parity.space"></option>
        </select>
        </td><td>
        <select type="text" id="node-config-input-stopbits" style="width:90%;">
            <option value="2">2</option>
            <option value="1">1</option>
        </select>
        </td></tr></table>
    </div>
    <br/>
    <div class="form-row">
        <label><i class="fa fa-sign-in"></i> <span data-i18n="serial.label.input"></span></label>
    </div>
    <div class="form-row" style="padding-left:10px;">
        <span data-i18n="serial.label.split"></span>
        <select type="text" id="node-config-input-out" style="margin-left:5px; width:200px;">
            <option value="char" data-i18n="serial.split.character"></option>
            <option value="time" data-i18n="serial.split.timeout"></option>
            <option value="interbyte" data-i18n="serial.split.silent"></option>
            <option value="count" data-i18n="serial.split.lengths"></option>
        </select>
        <input type="text" id="node-config-input-newline" style="width:50px;">
        <span id="node-units"></span>
    </div>
    <div class="form-row" style="padding-left:10px;">
        <span data-i18n="serial.label.deliver"></span>
        <select type="text" id="node-config-input-bin" style="margin-left:5px; width:150px;">
            <option value="false" data-i18n="serial.output.ascii"></option>
            <option value="bin" data-i18n="serial.output.binary"></option>
        </select>
    </div>
    <br/>
<!--
    <div id="node-config-addchar">
        <div class="form-row">
            <label><i class="fa fa-sign-out"></i> <span data-i18n="serial.label.output"></span></label>
        </div>
        <div class="form-row">
            <input style="width:30px; margin-left:10px; vertical-align:top;" type="checkbox" id="node-config-input-addchar"><label style="width:auto;" for="node-config-input-addchar"><span data-i18n="serial.addsplit"></span></label>
        </div>
    </div>
    <br/>
    <div id="node-config-addchar">
        <div class="form-row">
            <label><i class="fa fa-exchange"></i> <span data-i18n="serial.label.request"></span></label>
        </div>
        <div class="form-row" style="padding-left:10px;">
            <span data-i18n="serial.label.responsetimeout"></span>
            <input type="text" id="node-config-input-responsetimeout" style="width:60px;">
            <span data-i18n="serial.label.ms"></span>
        </div>
    </div>
    <div class="form-tips" id="tip-responsetimeout" hidden><span data-i18n="serial.tip.responsetimeout"></span></div>
-->
    <div class="form-tips" id="tip-split"><span data-i18n="serial.tip.split"></span></div>
    <div class="form-tips" id="tip-timeout" hidden><span data-i18n="serial.tip.timeout"></span></div>
    <div class="form-tips" id="tip-silent" hidden><span data-i18n="serial.tip.silent"></span></div>
</script>

<script type="text/x-red" data-help-name="serial-port" charset="utf-8">
    <p>本画面ではシリアルポートに対する設定オプションを提供します</p>
    <p>検索ボタンを押すことによって選択可能な有効なシリアルポートの一覧を表示します。もしくはポート名が既知ならばそのパスを指定することができます。</p>
    <p>入力データは固定文字列、もしくはタイムアウト秒数、固定文字数で区切って受信する設定ができます。</p>
    <p>文字を指定するときは文字そのもの、エスケープ文字列（\nなど)、16進コード(0x0dなど)を指定することができます。</p>
    <p>【注記】本ノードはシリアルポートノードの設定ノードを流用しています。</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('serial-port',{
        category: 'config',
        defaults: {
            //name: {value:""},
            serialport: {value:"",required:true},
            serialbaud: {value:"57600",required:true,validate:RED.validators.number()},
            databits: {value:8,required:true},
            parity: {value:"none",required:true},
            stopbits: {value:1,required:true},
            newline: {value:"\\n"},
            bin: {value:"false"},
            out: {value:"char"},
            addchar: {value:false},
            responsetimeout: {value: 10000}
        },
        label: function() {
            this.serialbaud = this.serialbaud || 57600;
            this.databits = this.databits || 8;
            this.parity = this.parity || this._("serial.label.none");
            this.stopbits = this.stopbits || 1;
            return this.serialport+":"+this.serialbaud+"-"+this.databits+this.parity.charAt(0).toUpperCase()+this.stopbits;
        },
        oneditprepare: function() {
            var previous = null;
            var blist = [
                {value:"115200",label:"115200",hasValue:false},
                {value:"57600",label:"57600",hasValue:false},
                {value:"38400",label:"38400",hasValue:false},
                {value:"19200",label:"19200",hasValue:false},
                {value:"9600",label:"9600",hasValue:false},
                {value:"4800",label:"4800",hasValue:false},
                {value:"2400",label:"2400",hasValue:false},
                {value:"1200",label:"1200",hasValue:false},
                {value:"600",label:"600",hasValue:false},
                {value:"300",label:"300",hasValue:false},
                {label:"other",value:"other",icon:"red/images/typedInput/09.png",validate:/^[0-9]*$/}
            ];

            var serialbaudType = "custom";
            for (var i in blist) {
                if (this.serialbaud == blist[i].value) {
                    serialbaudType = this.serialbaud;
                }
            }

            $("#node-config-input-serialbaud").typedInput({
                default: this.serialbaud,
                types:blist
            });

            $("#node-config-input-out").on('focus', function () { previous = this.value; }).change(function() {
                if (previous == null) { previous = $("#node-config-input-out").val(); }
                if ($("#node-config-input-out").val() == "char") {
                    if (previous != "char") { $("#node-config-input-newline").val("\\n"); }
                    $("#node-units").text("");
                    //$("#node-config-addchar").show();
                    $("#tip-split").show();
                    $("#tip-timeout").hide();
                    $("#tip-silent").hide();
                }
                else if ($("#node-config-input-out").val() == "time") {
                    if (previous != "time") { $("#node-config-input-newline").val("0"); }
                    $("#node-units").text("ms");
                    $("#node-config-addchar").hide();
                    //$("#node-config-input-addchar").val("false");
                    $("#tip-split").hide();
                    $("#tip-timeout").show();
                    $("#tip-silent").hide();
                }
                else if ($("#node-config-input-out").val() == "interbyte") {
                    if (previous != "interbyte") { $("#node-config-input-newline").val("0"); }
                    $("#node-units").text("ms");
                    $("#node-config-addchar").hide();
                    //$("#node-config-input-addchar").val("false");
                    $("#tip-split").hide();
                    $("#tip-timeout").hide();
                    $("#tip-silent").show();
                }
                else {
                    if (previous != "count") { $("#node-config-input-newline").val(""); }
                    $("#node-units").text("chars");
                    $("#node-config-addchar").hide();
                    //$("#node-config-input-addchar").val("false");
                    $("#tip-split").hide();
                    $("#tip-timeout").hide();
                    $("#tip-silent").hide();
                }
            });

            //$("#node-config-input-responsetimeout").on('focus', function () { $("#tip-responsetimeout").show(); });

            try {
                $("#node-config-input-serialport").autocomplete( "destroy" );
            } catch(err) {
            }
            $("#node-config-lookup-serial").click(function() {
                $("#node-config-lookup-serial").addClass('disabled');
                $.getJSON('serialports',function(data) {
                    $("#node-config-lookup-serial").removeClass('disabled');
                    var ports = [];
                    $.each(data, function(i, port) {
                        ports.push(port.comName);
                    });
                    $("#node-config-input-serialport").autocomplete({
                        source:ports,
                        minLength:0,
                        close: function( event, ui ) {
                            $("#node-config-input-serialport").autocomplete( "destroy" );
                        }
                    }).autocomplete("search","");
                });
            });
        },
        oneditsave: function() {
            var mytype = $("#node-config-input-serialbaud").typedInput('type');
            if (mytype !== "other") {
                $("#node-config-input-serialbaud").typedInput('value',mytype);
            }
            this.serialbaud = $("#node-config-input-serialbaud").typedInput('value');
        }
    });
</script>
